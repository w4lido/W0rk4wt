<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Concrete Mat Pro</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            background-color: #09090b; /* Zinc 950 */
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            touch-action: manipulation;
            overflow: hidden; /* Prevent scroll bounce */
        }
        
        /* Smooth Gradients */
        .bg-gradient-warmup { background: radial-gradient(circle at center, #431407 0%, #0c0a09 100%); }
        .bg-gradient-work { background: radial-gradient(circle at center, #450a0a 0%, #0c0a09 100%); }
        .bg-gradient-rest { background: radial-gradient(circle at center, #172554 0%, #0c0a09 100%); }
        .bg-gradient-cool { background: radial-gradient(circle at center, #064e3b 0%, #0c0a09 100%); }
        .bg-gradient-ready { background: radial-gradient(circle at center, #eab308 0%, #0c0a09 100%); }

        /* Animations */
        @keyframes breathe {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.98); }
        }
        .breathe-anim { animation: breathe 3s ease-in-out infinite; }
        
        @keyframes ping-slow {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.1); }
            70% { box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        .ping-anim { animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite; }

        .no-select {
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ADVANCED SYNTHESIZER AUDIO ENGINE ---
        // No external files. Pure math.
        const playSynth = (type) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const t = ctx.currentTime;

            // Master Gain (Volume)
            const master = ctx.createGain();
            master.connect(ctx.destination);
            master.gain.value = 0.5; // Base volume

            if (type === 'tick') {
                // Woodblock Tick
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(master);
                
                osc.frequency.setValueAtTime(800, t);
                osc.frequency.exponentialRampToValueAtTime(400, t + 0.05);
                
                gain.gain.setValueAtTime(0.3, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.05);
                
                osc.start(t);
                osc.stop(t + 0.06);
            } 
            else if (type === 'bell') {
                // Boxing Bell (Complex harmonic structure)
                const fund = 440; 
                [1, 2.1, 3.2, 4.8].forEach((ratio, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(master);
                    
                    osc.frequency.value = fund * ratio;
                    
                    const decay = i === 0 ? 1.5 : 0.5; // Fundamental rings longer
                    gain.gain.setValueAtTime(0.2, t);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + decay);
                    
                    osc.start(t);
                    osc.stop(t + decay);
                });
            }
            else if (type === 'whistle') {
                // Referee Whistle (Trill)
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const lfo = ctx.createOscillator(); // Modulator
                const lfoGain = ctx.createGain();
                
                lfo.connect(lfoGain);
                lfoGain.connect(osc.frequency);
                osc.connect(gain);
                gain.connect(master);
                
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(2000, t);
                
                lfo.frequency.value = 30; // Trill speed
                lfoGain.gain.value = 500; // Trill depth
                
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(0.3, t + 0.05);
                gain.gain.linearRampToValueAtTime(0, t + 0.3);
                
                osc.start(t);
                lfo.start(t);
                osc.stop(t + 0.3);
                lfo.stop(t + 0.3);
            }
            else if (type === 'ready') {
                // Low Start Tone
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(master);
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(220, t);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.exponentialRampToValueAtTime(0.001, t + 0.3);
                
                osc.start(t);
                osc.stop(t + 0.3);
            }
            else if (type === 'complete') {
                // Victory Chord
                [261.63, 329.63, 392.00, 523.25].forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(master);
                    
                    osc.type = 'triangle';
                    osc.frequency.value = freq;
                    
                    const start = t + (i * 0.1);
                    gain.gain.setValueAtTime(0, start);
                    gain.gain.linearRampToValueAtTime(0.1, start + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.001, start + 2);
                    
                    osc.start(start);
                    osc.stop(start + 2.5);
                });
            }
        };

        // --- WORKOUT DATA ---
        const WARMUP = [
            { name: "Neck Nods", duration: 60, type: "warmup", instruction: "20s Yes, 20s No, 20s Tilt", icon: "Neck" },
            { name: "Arm Circles", duration: 60, type: "warmup", instruction: "Start small, end big", icon: "Rotate" },
            { name: "Cat-Cow", duration: 60, type: "warmup", instruction: "Arch up, sink down", icon: "Spine" },
            { name: "Glute Bridges", duration: 60, type: "warmup", instruction: "Drive hips, squeeze glutes", icon: "Bridge" },
            { name: "Wrist Rolls", duration: 30, type: "warmup", instruction: "Prepare for sprawls", icon: "Hands" },
        ];

        const CIRCUIT_MOVE = [
            { name: "Sprawl", duration: 45, type: "work", instruction: "Pop hips up fast!", warning: "Exhale on pop-up!", icon: "Sprawl" },
            { name: "Walk to Bar", duration: 15, type: "rest", instruction: "Breathe. Get ready to hang.", icon: "Walk" },
            { name: "Pull-Up Negatives", duration: 60, type: "work", instruction: "5 Seconds Down per rep", icon: "Pullup" },
            { name: "Shake Arms", duration: 15, type: "rest", instruction: "Relax the shoulders", icon: "Shake" },
            { name: "Reverse Lunges", duration: 60, type: "work", instruction: "Tap knee gently", icon: "Legs" },
            { name: "Get to Floor", duration: 15, type: "rest", instruction: "Prepare for pushups", icon: "Floor" },
            { name: "Hindu Push-ups", duration: 45, type: "work", instruction: "Swoop low to high", warning: "Stop if shoulder hurts", icon: "Pushup" },
            { name: "Move to Table", duration: 15, type: "rest", instruction: "Prepare for rows", icon: "Move" },
            { name: "Bodyweight Row", duration: 45, type: "work", instruction: "Squeeze shoulder blades", icon: "Row" },
            { name: "Prepare Core", duration: 15, type: "rest", instruction: "Get into plank position", icon: "Plank" },
            { name: "Plank-to-Pushup", duration: 45, type: "work", instruction: "Steady hips. Constant motion.", icon: "Core" },
        ];

        const COOLDOWN = [
            { name: "90/90 Stretch (L)", duration: 60, type: "cool", instruction: "Lean over left knee", warning: "Breathe deep", icon: "Stretch" },
            { name: "90/90 Stretch (R)", duration: 60, type: "cool", instruction: "Lean over right knee", warning: "Breathe deep", icon: "Stretch" },
            { name: "Dead Hang", duration: 45, type: "cool", instruction: "Decompress spine", icon: "Hang" },
            { name: "Child's Pose", duration: 60, type: "cool", instruction: "Relax completely", icon: "Child" },
        ];

        const buildPlan = () => {
            let plan = [...WARMUP];
            const rounds = 3;
            for (let i = 0; i < rounds; i++) {
                plan = [...plan, ...CIRCUIT_MOVE];
                if (i < rounds - 1) {
                    plan.push({ 
                        name: "ROUND REST", 
                        duration: 120, 
                        type: "round-rest", 
                        instruction: "Walk. Sip Water. Do not sit.", 
                        icon: "Water" 
                    });
                }
            }
            plan = [...plan, ...COOLDOWN];
            return plan;
        };

        const FULL_PLAN = buildPlan();

        // --- ICONS ---
        // Using raw SVG paths for reliability and custom look
        const SvgIcon = ({ name, size=32, className="" }) => {
            const paths = {
                Neck: <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />,
                Rotate: <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />,
                Spine: <path d="M3 12h18M3 6h18M3 18h18" />, // Simplified
                Bridge: <path d="M4 18h16v-4a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v4" />, // Abstract
                Hands: <circle cx="12" cy="12" r="10" />, 
                Sprawl: <path d="M12 5v14M5 12h14" />, // Crosshair focus
                Walk: <path d="M13 20l-3-6 2-4H8l2 4-3 6" />, // Stick figure leg
                Pullup: <path d="M12 3v18M8 7l4-4 4 4" />, // Arrow Up
                Shake: <path d="M4 12h16M12 4v16" />, 
                Legs: <path d="M9 21V10H5l7-7 7 7h-4v11" />, 
                Floor: <rect x="2" y="18" width="20" height="4" rx="1" />,
                Pushup: <path d="M2 16h20M12 8v8" />,
                Row: <path d="M12 21V3M8 17l4 4 4-4" />, // Arrow Down
                Plank: <rect x="2" y="10" width="20" height="4" />,
                Core: <rect x="6" y="6" width="12" height="12" rx="2" />,
                Stretch: <path d="M4 12a8 8 0 0 1 16 0" />,
                Hang: <path d="M12 3v10" />,
                Child: <circle cx="12" cy="12" r="8" />,
                Water: <path d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.58 9 8a9 9 0 0 1-9 10z" />,
                Play: <polygon points="5 3 19 12 5 21 5 3" />,
                Pause: <rect x="6" y="4" width="4" height="16" />,
                Pause2: <rect x="14" y="4" width="4" height="16" />,
                Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
            };

            const renderPath = () => {
                if (name === 'Pause') return <g>{paths.Pause}{paths.Pause2}</g>;
                return paths[name] || paths.Activity;
            };

            return (
                <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    {renderPath()}
                </svg>
            );
        };

        // --- CIRCULAR TIMER COMPONENT ---
        const CircularTimer = ({ duration, timeLeft, type }) => {
            const radius = 120;
            const stroke = 12;
            const normalizedRadius = radius - stroke * 2;
            const circumference = normalizedRadius * 2 * Math.PI;
            const strokeDashoffset = circumference - (timeLeft / duration) * circumference;

            let strokeColor = "stroke-white";
            if (type === 'work') strokeColor = "stroke-red-500";
            if (type === 'rest' || type === 'round-rest') strokeColor = "stroke-blue-400";
            if (type === 'warmup') strokeColor = "stroke-orange-400";
            if (type === 'cool') strokeColor = "stroke-emerald-400";
            if (type === 'ready') strokeColor = "stroke-yellow-400";

            return (
                <div className="relative flex items-center justify-center">
                    <svg height={radius * 2} width={radius * 2} className="rotate-[-90deg] transition-all duration-500">
                        <circle
                            className="stroke-white/10"
                            strokeWidth={stroke}
                            fill="transparent"
                            r={normalizedRadius}
                            cx={radius}
                            cy={radius}
                        />
                        <circle
                            className={`${strokeColor} transition-all duration-1000 linear`}
                            strokeWidth={stroke}
                            strokeDasharray={circumference + ' ' + circumference}
                            style={{ strokeDashoffset }}
                            strokeLinecap="round"
                            fill="transparent"
                            r={normalizedRadius}
                            cx={radius}
                            cy={radius}
                        />
                    </svg>
                    <div className="absolute text-center">
                        <span className="text-7xl font-black tracking-tighter tabular-nums block drop-shadow-lg">
                            {timeLeft}
                        </span>
                        <span className="text-xs font-bold uppercase opacity-60 tracking-widest">
                            Seconds
                        </span>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState('intro'); // intro, ready, active, finished
            const [currentStep, setCurrentStep] = useState(0);
            const [timeLeft, setTimeLeft] = useState(5);
            const [paused, setPaused] = useState(false);

            // Initialize Audio
            const initAudio = () => {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    const ctx = new AudioContext();
                    ctx.resume();
                }
            };

            const handleStart = () => {
                initAudio();
                setGameState('ready');
                setTimeLeft(5); // 5 Second Buffer
                playSynth('ready');
            };

            useEffect(() => {
                let interval = null;
                
                if (!paused && gameState !== 'intro' && gameState !== 'finished') {
                    interval = setInterval(() => {
                        setTimeLeft((prev) => {
                            // --- TIMER LOGIC ---
                            
                            // 1. Countdown ticks
                            if (prev <= 4 && prev > 1) {
                                playSynth('tick');
                            }

                            // 2. Phase Transition
                            if (prev <= 1) {
                                if (gameState === 'ready') {
                                    setGameState('active');
                                    playSynth('bell'); // Start Workout
                                    return FULL_PLAN[0].duration;
                                }
                                
                                // Move to next step
                                if (currentStep < FULL_PLAN.length - 1) {
                                    const nextIndex = currentStep + 1;
                                    const nextType = FULL_PLAN[nextIndex].type;
                                    
                                    setCurrentStep(nextIndex);
                                    
                                    // Sound Logic
                                    if (nextType === 'work') playSynth('whistle');
                                    else if (nextType.includes('rest')) playSynth('bell');
                                    else playSynth('ready');

                                    return FULL_PLAN[nextIndex].duration;
                                } else {
                                    setGameState('finished');
                                    playSynth('complete');
                                    return 0;
                                }
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [gameState, paused, currentStep]);

            const step = FULL_PLAN[currentStep];
            const nextStep = FULL_PLAN[currentStep + 1];

            // Dynamic Background
            const getBackgroundClass = () => {
                if (gameState === 'intro') return 'bg-zinc-950';
                if (gameState === 'ready') return 'bg-gradient-ready';
                if (gameState === 'finished') return 'bg-zinc-900';
                
                const type = step.type;
                if (type === 'warmup') return 'bg-gradient-warmup';
                if (type === 'work') return 'bg-gradient-work';
                if (type === 'rest') return 'bg-gradient-rest';
                if (type === 'round-rest') return 'bg-gradient-rest';
                if (type === 'cool') return 'bg-gradient-cool';
                return 'bg-zinc-900';
            };

            // --- INTRO SCREEN ---
            if (gameState === 'intro') {
                return (
                    <div className="flex flex-col h-screen items-center justify-center p-8 text-center space-y-8 bg-zinc-950 text-white">
                        <div className="space-y-2 relative">
                            <div className="absolute -inset-1 bg-yellow-500 blur opacity-20 rounded-full"></div>
                            <h1 className="relative text-6xl font-black italic tracking-tighter leading-none">
                                CONCRETE<br/>MAT
                                <span className="text-yellow-500">.</span>
                            </h1>
                            <div className="flex items-center justify-center gap-2 text-yellow-500/80 font-bold tracking-widest text-sm uppercase mt-4">
                                <SvgIcon name="Activity" size={16} /> Pro Edition
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 w-full max-w-xs">
                            <div className="bg-white/5 p-4 rounded-2xl border border-white/10 backdrop-blur-sm">
                                <div className="text-2xl font-bold">45</div>
                                <div className="text-xs text-zinc-400 uppercase tracking-wider">Minutes</div>
                            </div>
                            <div className="bg-white/5 p-4 rounded-2xl border border-white/10 backdrop-blur-sm">
                                <div className="text-2xl font-bold">3</div>
                                <div className="text-xs text-zinc-400 uppercase tracking-wider">Rounds</div>
                            </div>
                        </div>

                        <button 
                            onClick={handleStart}
                            className="w-full max-w-xs bg-yellow-500 text-black font-black text-xl py-5 px-8 rounded-2xl shadow-lg shadow-yellow-500/20 active:scale-95 transition-transform flex items-center justify-center gap-3"
                        >
                            <SvgIcon name="Play" size={24} className="fill-black" />
                            START
                        </button>
                        <p className="text-xs text-zinc-600">Turn on sound. Do not lock screen.</p>
                    </div>
                );
            }

            // --- FINISHED SCREEN ---
            if (gameState === 'finished') {
                return (
                    <div className="flex flex-col h-screen items-center justify-center p-6 text-center bg-zinc-900 text-white">
                        <div className="mb-8 p-8 bg-green-500/10 rounded-full border border-green-500/20 text-green-500 ping-anim">
                            <SvgIcon name="Activity" size={64} />
                        </div>
                        <h2 className="text-4xl font-black mb-4">SESSION<br/>COMPLETE</h2>
                        <p className="text-lg text-zinc-400 max-w-xs mb-8 leading-relaxed">
                            Excellent work. Your cardio is improving. <br/>
                            <span className="text-white font-bold">Eat protein now.</span>
                        </p>
                        <button 
                            onClick={() => window.location.reload()}
                            className="bg-white text-black font-bold py-4 px-10 rounded-full active:scale-95"
                        >
                            Finish
                        </button>
                    </div>
                );
            }

            // --- MAIN WORKOUT SCREEN ---
            const isReadyPhase = gameState === 'ready';
            const displayTime = isReadyPhase ? timeLeft : timeLeft;
            const displayMax = isReadyPhase ? 5 : step.duration;
            const displayType = isReadyPhase ? 'ready' : step.type;
            
            return (
                <div className={`flex flex-col h-screen transition-all duration-700 ${getBackgroundClass()} no-select overflow-hidden`}>
                    
                    {/* Header */}
                    <div className="flex justify-between items-center p-6 pt-8">
                        <div className="flex flex-col">
                            <span className="text-[10px] font-bold tracking-[0.2em] uppercase opacity-50">Phase</span>
                            <span className="text-sm font-bold uppercase text-white">{isReadyPhase ? "Get Ready" : step.type}</span>
                        </div>
                        <div className="flex flex-col items-end">
                            <span className="text-[10px] font-bold tracking-[0.2em] uppercase opacity-50">Step</span>
                            <span className="text-sm font-mono font-bold text-white">{isReadyPhase ? "-" : `${currentStep + 1}/${FULL_PLAN.length}`}</span>
                        </div>
                    </div>

                    {/* Main Viz */}
                    <div className="flex-1 flex flex-col items-center justify-center relative z-10">
                        
                        {/* Timer Ring */}
                        <div className="mb-8 scale-90 sm:scale-100 transition-transform">
                            <CircularTimer 
                                duration={displayMax} 
                                timeLeft={displayTime} 
                                type={displayType} 
                            />
                        </div>

                        {/* Content */}
                        <div className="text-center px-6 max-w-sm mx-auto">
                            <h2 className="text-4xl font-black uppercase mb-3 leading-none drop-shadow-md">
                                {isReadyPhase ? "GET READY" : step.name}
                            </h2>
                            
                            {!isReadyPhase && (
                                <div className="space-y-4 breathe-anim">
                                    <p className="text-xl text-white/90 font-medium leading-snug">
                                        {step.instruction}
                                    </p>
                                    {step.warning && (
                                        <div className="inline-block bg-red-500/20 border border-red-500/50 text-red-100 px-3 py-1 rounded-lg text-xs font-bold uppercase tracking-wide">
                                            ⚠️ {step.warning}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Footer / Controls */}
                    <div className="bg-black/20 backdrop-blur-xl border-t border-white/5 p-6 pb-10 safe-area-bottom">
                        
                        {!isReadyPhase && nextStep && (
                            <div className="flex items-center justify-between mb-6 px-2 opacity-70">
                                <span className="text-xs font-bold uppercase tracking-widest text-zinc-400">Up Next</span>
                                <span className="text-sm font-bold text-white">{nextStep.name}</span>
                            </div>
                        )}

                        <div className="grid grid-cols-4 gap-3">
                            <button 
                                onClick={() => setPaused(!paused)}
                                className={`col-span-3 font-black py-4 rounded-2xl flex items-center justify-center gap-3 text-lg active:scale-95 transition-all shadow-lg ${paused ? 'bg-green-500 text-white' : 'bg-white text-black'}`}
                            >
                                <SvgIcon name={paused ? "Play" : "Pause"} size={24} className={paused ? "fill-white" : "fill-black"} />
                                {paused ? "RESUME" : "PAUSE"}
                            </button>
                            
                            <button 
                                onClick={() => setTimeLeft(0)}
                                className="col-span-1 bg-white/10 hover:bg-white/20 text-white font-bold rounded-2xl flex items-center justify-center active:scale-95 transition-all"
                            >
                                <SvgIcon name="Activity" size={24} /> {/* Skip Icon */}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>